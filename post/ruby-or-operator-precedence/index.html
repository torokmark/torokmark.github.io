<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

        
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

        <link href="https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono" rel="stylesheet"> 

        <title>Ruby or operator precedence</title>

        <link rel="stylesheet" href="/css/stylesheet.css">
    </head>
    <body>
      <div class="container-fluid">
        <nav class="navbar navbar-expand-md navbar-light">

          
          <span class="navbar-brand mb-0 h1"></span>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle Navigation" name="button">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link " href="/">Home</a>
              
              
              <a class="nav-item nav-link " href="/contact/">Contact</a>
              <a class="nav-item nav-link " href="/about/">About</a>
            </div>
          </div>
        </nav>

        <section id="page-title">
          <h1><a href="/">T[h]inking</a></h1>
          <span id="author-name">
            <h6><a href="/about/"></a></h6>
          </span>
        </section>


<div class="blog-post">
  <h1>Ruby or operator precedence</h1>
  <div class="blog-post-subheader">
    <time>23 Aug 2019</time>
  </div>
  <div class="blog-post-content">
    <p><strong>Operators have precedence and sometimes they can give us hard time to figure
out why our code works as it does.</strong></p>

<p>Ruby has three <em>or</em> operators, <code>|</code>, <code>||</code>, and the readable <code>or</code>. All of them
have different precedences. That is, the precedence, that makes some trouble if
we do not care about which one we use.</p>

<p>The evaluation of logical operators are left-associative, that means the far left
operator is evaluated at first, than its result will be the left operand of the
next operator and so on. <code>|</code> operator evaluates both operands, while <code>||</code> or <code>or</code>
are short-circuit operators.</p>

<p>There are two falsy values in the language, <code>false</code> and <code>nil</code>, anything else belong
to the truthy set. <code>|</code> operator works as expected and returns logical values.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">puts <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">nil</span>  <span style="color:#75715e"># false</span>
puts <span style="color:#66d9ef">true</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">nil</span>   <span style="color:#75715e"># true</span>
puts <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span>   <span style="color:#75715e"># true</span>
puts <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># false, here 3 is consider as an int value, not a logical value  </span></code></pre></div>
<p>In case of <code>||</code> and <code>or</code> operators returned value is not logical, as it would be in case of <code>|</code>.
Nothing has suprised us!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">puts <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># 3</span>
puts <span style="color:#ae81ff">3</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># true</span>
puts <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">or</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># 3</span>
puts <span style="color:#ae81ff">3</span> <span style="color:#f92672">or</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># true</span></code></pre></div>
<p>Let us see a bit more complex example and examine the results. Since both <code>||</code>
and <code>or</code> are lazy operators, if left-hand side operand is true, the right-hand
side operand won&rsquo;t be evaluated, hence we understand why empty string is
emitted instead of <code>3</code> in place of <code>b</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">||</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
puts <span style="color:#e6db74">&#34;|| &#39;</span><span style="color:#e6db74">#{</span> a <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#e6db74">#{</span> b <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>  <span style="color:#75715e"># || &#39;2&#39; &#39;&#39;</span>
a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">or</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
puts <span style="color:#e6db74">&#34;or &#39;</span><span style="color:#e6db74">#{</span> a <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#e6db74">#{</span> b <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>  <span style="color:#75715e"># or &#39;2&#39; &#39;&#39;</span></code></pre></div>
<p>What if the right-hand side operator is also evaluated, since the result of the
expression is <code>false</code> on the left.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">||</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
puts <span style="color:#e6db74">&#34;|| &#39;</span><span style="color:#e6db74">#{</span> a <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#e6db74">#{</span> b <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>  <span style="color:#75715e"># || &#39;3&#39; &#39;3&#39;</span>
a <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">or</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>  
puts <span style="color:#e6db74">&#34;or &#39;</span><span style="color:#e6db74">#{</span> a <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#e6db74">#{</span> b <span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>  <span style="color:#75715e"># or &#39;false&#39; &#39;3&#39;</span></code></pre></div>
<p>Uhh, quite wierd results. Not just they are different, but the value of <code>a</code> is
the same as the value of <code>b</code>. Where is <code>false</code>?</p>

<p>The trick is that the precedence of <code>||</code> is higher than the precedence of <code>=</code> (assign),
but the precedence of <code>=</code> is higher than the precedence of <code>or</code>.</p>

<p>According to the abovementioned lines, the evaluation of <code>||</code> looks as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> (<span style="color:#66d9ef">false</span> <span style="color:#f92672">||</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) 
a <span style="color:#f92672">=</span> ( b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> ) 
a <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span></code></pre></div>
<p><em>And</em> operators, like <code>&amp;</code>, <code>&amp;&amp;</code>, and <code>and</code>, work similar.</p>

<p><strong>As we see the precedence of operators can cause a big mess if we are not circumspect enough.
Though, if it is possible, use <code>||</code> operator and be careful.</strong></p>

<p>Sample can be found: <a href="https://gist.github.com/torokmark/8347c58f0cda918e99cb43fba84aea81">https://gist.github.com/torokmark/8347c58f0cda918e99cb43fba84aea81</a></p>

  </div>
</div>

      <footer>
        <hr>
        <small>
          &copy; 2019 .
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using the <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a> theme.
        </small>
      </footer>
    </div> 

    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  </body>
</html>

