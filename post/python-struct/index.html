<!DOCTYPE html>
<html>
    <head>
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154887805-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-154887805-1');
        </script>
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

        
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

        <link href="https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono" rel="stylesheet"> 

        <title>Ruby-like struct in Python</title>

        <link rel="stylesheet" href="/css/stylesheet.css">
    </head>
    <body>
      <div class="container-fluid">
        <nav class="navbar navbar-expand-md navbar-light">

          
          <span class="navbar-brand mb-0 h1"></span>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle Navigation" name="button">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link " href="/">Home</a>
              
              
              <a class="nav-item nav-link " href="/contact/">Contact</a>
              <a class="nav-item nav-link " href="/about/">About</a>
            </div>
          </div>
        </nav>

        <section id="page-title">
          <h1><a href="/">T[h]ink]er[ing</a></h1>
          <span id="author-name">
            <h6><a href="/about/"></a></h6>
          </span>
        </section>


<div class="blog-post">
  <h1>Ruby-like struct in Python</h1>
  <div class="blog-post-subheader">
    <time>19 Oct 2019</time>
  </div>
  <div class="blog-post-content">
    

<p><strong>Ruby provides a very flexible way to create new types with certain fields with
Struct. Though Python does not have this functionality naturally, with <em>esu</em>
package we can do the same.</strong></p>

<p>Ruby types have rich API which is brought by the design, and the language
features as well. Even though Python is very dynamic and flexible as well, some
of the features are lacking in the languages.</p>

<p>In this post I would like to show you a Python package, name is <strong>esu</strong>, which
brings a <em>struct</em> that can provide almost the same functionality.</p>

<h3 id="usage">Usage</h3>

<p>Ruby&rsquo;s Struct (<a href="https://ruby-doc.org/core-2.6.5/Struct.html">doc:2.6.5</a>) looks
as follows. This brings the goal how our one should look like.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rb" data-lang="rb"><span style="color:#66d9ef">Customer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">Struct</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">:name</span>, <span style="color:#e6db74">:address</span>) <span style="color:#66d9ef">do</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">greeting</span>
    <span style="color:#e6db74">&#34;Hello </span><span style="color:#e6db74">#{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

dave <span style="color:#f92672">=</span> <span style="color:#66d9ef">Customer</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;Dave&#34;</span>, <span style="color:#e6db74">&#34;123 Main&#34;</span>)
dave<span style="color:#f92672">.</span>name     <span style="color:#75715e">#=&gt; &#34;Dave&#34;</span>
dave<span style="color:#f92672">.</span>greeting <span style="color:#75715e">#=&gt; &#34;Hello Dave!&#34;</span></code></pre></div>
<p>Here is beneath <code>Struct</code> type provided by <em>esu</em>. As we see in case of Ruby,
field names and methods can be passed to <code>Struct</code> in Python as well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">from</span> esu <span style="color:#f92672">import</span> Struct

Customer <span style="color:#f92672">=</span> Struct(
        <span style="color:#e6db74">&#39;Customer&#39;</span>,
        <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;address&#39;</span>,
        methods<span style="color:#f92672">=</span>{
            <span style="color:#e6db74">&#39;greeting&#39;</span>: <span style="color:#66d9ef">lambda</span> self: <span style="color:#e6db74">&#34;Hello {}&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">&#39;name&#39;</span>])
        })

dave <span style="color:#f92672">=</span> Customer()
dave<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Dave&#39;</span>
dave<span style="color:#f92672">.</span>greeting() <span style="color:#75715e"># =&gt; Hello Dave</span>

anna <span style="color:#f92672">=</span> Customer(<span style="color:#e6db74">&#39;Anna&#39;</span>, <span style="color:#e6db74">&#39;432 Avenue&#39;</span>)
anna<span style="color:#f92672">.</span>greeting() <span style="color:#75715e"># =&gt; Hello Anna</span></code></pre></div>
<h3 id="implementation">Implementation</h3>

<p>Metaprogramming is a very handy and efficient tool when we are intended to build
types, extend classes with fields and methods during the runtime. Python
provides good support on this.</p>

<p>Python provides a function, called <code>type</code> (<a href="https://docs.python.org/3/library/functions.html#type">doc:3.8</a>),
that creates new types based on the parameter passed to it.</p>

<p>The first parameter is the name of the new type, which is passed as the first param of
<code>Struct</code>. The second param of <code>type</code> is the parent type, here we take the good
old <code>object</code>, and finally the dictionary of the fields, where fieldname is the
key and, as we do not have values to them, we set their values to <code>None</code> as
default.</p>

<h4 id="fields">Fields</h4>

<p>List of fields can be defined in the ctor of <code>Struct</code>. That accepts as many
fields as we want to. These names will be available as members of the instance
created from the new type.</p>

<h4 id="methods">Methods</h4>

<p>Methods can be passed as a named parameter of <code>Struct</code>&rsquo;s ctor for <code>methods</code>
parameter. It is a <code>dict</code>, method name is the key, while the lambda expression
is the body of the method.</p>

<p>The lambda expression has to have one argument at least, that will be the <em>self
reference</em>. To get access to the fields or other methods, we have to use
<code>__dict__</code> member of self, and giving the name of the member as key on
<code>__dict__</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">methods<span style="color:#f92672">=</span>{
    <span style="color:#e6db74">&#39;greeting&#39;</span>: <span style="color:#66d9ef">lambda</span> self: <span style="color:#e6db74">&#34;Hello {}&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">&#39;name&#39;</span>])
}</code></pre></div>
<p>Unfortunately, lambda is not as expressive as block statement in Ruby. Though,
there are workarounds to achieve multiline statements, it is quite unconvinient.
If we liked to do that, it would be a better way to define method previously and
pass them in place of the lambda expression.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">greeting</span>(self):
    <span style="color:#75715e"># multiline comes here...</span>
    <span style="color:#75715e"># and here ...</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello {}&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">&#39;name&#39;</span>]

methods<span style="color:#f92672">=</span>{
    <span style="color:#e6db74">&#39;greeting&#39;</span>: greeting)
}</code></pre></div>
<h4 id="ctor">Ctor</h4>

<p>The newly created type&rsquo;s ctor accepts the values of the fields in the same order
as we defined the fieldnames. If non-args is given, all the fields have the
default <code>None</code> value. If args is just partially given, <code>ValueError</code> exception is
raised.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">dave <span style="color:#f92672">=</span> Customer()
dave<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Dave&#39;</span>
dave<span style="color:#f92672">.</span>age <span style="color:#f92672">=</span> <span style="color:#ae81ff">54</span>

bob <span style="color:#f92672">=</span> Customer(<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#ae81ff">25</span>)
<span style="color:#66d9ef">print</span>(bob<span style="color:#f92672">.</span>name) <span style="color:#75715e"># =&gt; Bob</span></code></pre></div>
<h4 id="basic-functionality">Basic functionality</h4>

<p>There are some methods, which I consider useful and important enough to add them
to the newly created type.</p>

<ul>
<li>ctor itself,</li>
<li><code>__eq__</code> to compare two instances,</li>
<li><code>__hash__</code> to compute the hash value of an instance,</li>
<li><code>__str__</code> to provide a string representation of the instance,</li>
<li><code>__len__</code>, which returns the number of fields,</li>
<li><code>members</code> returns the tuple of fieldnames</li>
<li><code>values</code> returns the tuple of values in the order of fieldnames.</li>
</ul>

<p>All of them can be overwritten if the appropriate method is passed to the
<code>Struct</code>.</p>

<p><strong>In this post we saw a Python package which brings the flexible functionality
that Ruby&rsquo;s Struct brings for us. Enjoy using it!</strong></p>

<p>You can find the repository fo the package here: <a href="https://github.com/torokmark/esu">https://github.com/torokmark/esu</a><br />
The pip package can be found here: <a href="https://pypi.org/project/esu">https://pypi.org/project/esu</a><br />
The documentation is here: <a href="https://esu.readthedocs.io">https://esu.readthedocs.io</a></p>

  </div>
</div>

      <footer>
        <hr>
        <small>
          &copy; 2020 .
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> using the <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a> theme.
        </small>
      </footer>
    </div> 

    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  </body>
</html>

